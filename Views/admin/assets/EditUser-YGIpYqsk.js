import{r as t,A as Y,u as Z,j as s,L as D,c,d as o}from"./index-algzo-nC.js";import{T as r}from"./TextInput-l4_44VDM.js";import{S as F}from"./react-select.esm-lLAdDy9E.js";import"./defineProperty-QXht6sKD.js";import"./typeof-Q9eVcF_1.js";import"./emotion-react.browser.esm-iBc53iNB.js";import"./hoist-non-react-statics.cjs-ruMgn741.js";const re=()=>{const{currentUser:i}=t.useContext(Y),R=i==null?void 0:i.id,[l,A]=t.useState(null),[p,u]=t.useState(""),[h,b]=t.useState(""),[x,f]=t.useState(""),[g,w]=t.useState({value:"",label:""}),[j,v]=t.useState(""),[N,C]=t.useState({value:"",label:""}),[O,$]=t.useState(null),{id:y}=Z(),S=+y,[d,T]=t.useState([]),[m,I]=t.useState([]),[P,H]=t.useState([]),[E,L]=t.useState([]);t.useEffect(()=>{(async()=>{try{const a=await c.get("/departments/"),n=await c.get("/job-roles/");I(a.data),T(n.data)}catch(a){console.log(a)}})()},[]),t.useEffect(()=>{d.length>0&&H(d.map(e=>({label:e.role,value:e.role}))),m.length>0&&L(m.map(e=>({label:e.name,value:e.name})))},[d,m]);const[k,_]=t.useState(!1),[J,M]=t.useState(""),[U,q]=t.useState(""),[z,B]=t.useState(""),G=async e=>{try{return(await c.get(`/users/${e}`)).data}catch(a){console.log(a),o({error:a.response.data.error})}};t.useEffect(()=>{(async()=>{const a=await G(S);A(a[0])})()},[]),t.useEffect(()=>{if(l){u(l==null?void 0:l.email),f(l==null?void 0:l.username),b(l==null?void 0:l.full_name),v(l==null?void 0:l.contact);const e=P.find(n=>n.value===(l==null?void 0:l.role));w(e);const a=E.find(n=>n.value===(l==null?void 0:l.department));C(a)}},[l]);const K=e=>{const a=e.target.files[0];$(a)},Q=async()=>{console.log("fn triggered");try{const e=new FormData;e.append("email",p),e.append("username",x),e.append("full_name",h),e.append("contact",j),e.append("role",g.value),e.append("department",N.value),e.append("avatar",O);const a=await c.put(`/users/${y}`,e,{headers:{"Content-Type":"multipart/form-data"}});console.log(a.data),o(a.data)}catch(e){console.log(e),o({error:e.response.data.error})}},V=async()=>{if(U!==z){o({error:"Password mismatch!"});return}const e=await W(R,J);if(console.log("is password",e),!e){o({error:"Admin password incorrect"});return}await X(U)},W=async(e,a)=>{try{if((await c.post(`/users/check-password/${e}`,{password:a})).status===200)return!0}catch(n){return console.log(n),!1}},X=async e=>{try{const a=await c.put(`users/change-password/${S}`,{password:e});o(a.data)}catch(a){console.log(a),o({error:a.response.data.error})}};return s.jsxs("div",{children:[s.jsxs("div",{className:"page-title-box d-flex justify-content-between",children:[s.jsx("h4",{className:"page-title",children:"Edit User"}),s.jsx("nav",{"aria-label":"breadcrumb",children:s.jsxs("ol",{className:"breadcrumb",children:[s.jsx("li",{className:"breadcrumb-item",children:s.jsx(D,{to:"/",className:"b-link",children:"Home"})}),s.jsxs("li",{className:"breadcrumb-item",children:[s.jsx(D,{to:"#",className:"b-link"}),"User"]}),s.jsx("li",{className:"breadcrumb-item active","aria-current":"page",children:"Edit User"})]})})]}),s.jsxs("div",{className:"content",children:[s.jsxs("div",{className:"row",children:[s.jsx("div",{className:"col-6",children:s.jsx(r,{label:"Email:",type:"email",parentClasses:"d-flex align-items-baseline",labelClass:"col-2 fw-bold",inputClass:"col",value:p,onChange:e=>u(e.target.value)})}),s.jsx("div",{className:"col-6",children:s.jsx(r,{label:"Username:",type:"text",parentClasses:"d-flex align-items-baseline",labelClass:"col-2 fw-bold",inputClass:"col",value:x,onChange:e=>f(e.target.value)})})]}),s.jsxs("div",{className:"row mt-3",children:[s.jsx("div",{className:"col-6",children:s.jsx(r,{label:"Full Name:",type:"Text",parentClasses:"d-flex align-items-baseline",labelClass:"col-2 fw-bold",inputClass:"col",value:h,onChange:e=>b(e.target.value)})}),s.jsx("div",{className:"col-6",children:s.jsx(r,{label:"Contact:",type:"text",parentClasses:"d-flex align-items-baseline",labelClass:"col-2 fw-bold",inputClass:"col",value:j,onChange:e=>v(e.target.value)})})]}),s.jsxs("div",{className:"row mt-3",children:[s.jsx("div",{className:"col-6",children:s.jsxs("div",{className:"d-flex align-items-baseline",children:[s.jsx("label",{htmlFor:"role",className:"col-2 fw-bold",children:"Job Role:"}),s.jsx(F,{className:"col p-0",isSearchable:!0,options:P,value:g,onChange:e=>w(e)})]})}),s.jsx("div",{className:"col-6",children:s.jsxs("div",{className:"d-flex align-items-baseline",children:[s.jsx("label",{htmlFor:"role",className:"col-2 fw-bold",children:"Department:"}),s.jsx(F,{className:"col p-0",isSearchable:!0,options:E,value:N,onChange:e=>C(e)})]})})]}),s.jsxs("div",{className:"row mt-3",children:[s.jsx("div",{className:"col-6",children:s.jsxs("div",{className:"d-flex align-items-baseline",children:[s.jsx("label",{htmlFor:"picture",className:"fw-bold col-2",children:"Profile Picture:"}),s.jsx("input",{className:"form-control col",type:"file",onChange:K,multiple:!0})]})}),s.jsxs("div",{className:"col",children:[s.jsx("button",{className:"btn btn-warning d-block ms-auto ",onClick:()=>_(!k),children:"Change Password"}),k&&s.jsxs("div",{className:"col ",children:[s.jsx(r,{parentClasses:"col",label:"Admin Password:",type:"password",onChange:e=>M(e.target.value)}),s.jsx(r,{parentClasses:"col mt-1",label:"New Password:",type:"password",onChange:e=>q(e.target.value)}),s.jsx(r,{parentClasses:"col mt-1",label:"Confirm Password:",type:"password",onChange:e=>B(e.target.value)}),s.jsx("button",{className:"btn btn-primary d-block ms-auto mt-3",onClick:V,children:"Change Password"})]})]})]}),s.jsx("div",{className:"row mt-3",children:s.jsx("button",{className:"btn btn-primary col-1",onClick:Q,children:"Update"})})]})]})};export{re as default};
